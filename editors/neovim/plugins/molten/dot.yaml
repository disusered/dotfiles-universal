linux[whoami.distro^="Arch"]:
  installs:
    cmd: |
      # 1. Define paths
      PROJECT_ROOT=~/.config/nvim
      VENV_PATH=~/.local/share/virtualenvs/neovim

      # 2. Tell uv which venv to use
      export VIRTUAL_ENV=$VENV_PATH

      # 3. Go to the project directory
      # This is so uv can find pyproject.toml and uv.lock
      cd $PROJECT_ROOT

      # 4. Add all packages to the project
      # This updates pyproject.toml, uv.lock, AND
      # installs them into the $VIRTUAL_ENV
      uv add --active jupyter_client cairosvg plotly kaleido pnglatex pyperclip nbformat pillow requests websocket-client
      uv sync --active

      # 5. Create jupyter runtime dir
      mkdir -p ~/.local/share/jupyter/runtime
      chmod 700 ~/.local/share/jupyter/runtime
    depends:
      - /editor/neovim
      - /lib/wl-clipboard
  links:
    molten.lua: ~/.config/nvim/lua/plugins/molten.lua
# Jupyter Kernel Registration Workflow:
# 1. In your project: uv venv
# 2. Add dependencies: uv add ipykernel
# 3. Activate venv: source .venv/bin/activate
# 4. Register kernel: python -m ipykernel install --user --name=<projectname>
# 5. Launch nvim (with venv activated or use venv-selector plugin)
# 6. Use <leader>ji to select the registered kernel from picker
